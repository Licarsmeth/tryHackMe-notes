## Metasploit

- **[Basic commands](https://tryhackme.com/room/metasploitintro)** 
	- msfconsole - use the console 
	- use [module] - Load module (exploit, auxiliary, payload)
		- you can do something like `use 0` in place of the entire name if it's in the 0th position in a list of output from things  like the search command.
	- search [keyword] - Find modules (by cve, name, host)
	- info - Show module details
	- show options - Display required parameters
		- show missing - show remaining "yes" fields
	- set [option] value - Configure (RHOSTS, LHOST, payloads)
		- use unset or unset all to unset
		- use setg or unsetg for global settings.
	- show payloads - List compatible payloads
		- exploits have a default payload. you can use this to see what else exist
		- then set payload `number` to set the new one
		- Note that choosing a working payload could become a trial and error process due to environmental or OS restrictions such as firewall rules, anti-virus, file writing, or the program performing the payload execution isn't available 
	- migrate - migrate to a process
		- inside meterpreter, type `ps` to see all processes
		- migrate pid to migrate to that process
	- exploit/run - Execute
		- The `exploit -z` command will run the exploit and background the session as soon as it opens.
		- This will return you the context prompt from which you have run the exploit.
		- Some modules support the `check` option. This will check if the target system is vulnerable without exploiting it.
	- back - get back to main msf console
	- sessions 
		- Once a vulnerability has been successfully exploited, a session will be created
		- The `sessions` command can be used from the msfconsole prompt or any context to see the existing sessions.
		- You can use the `background` command in the meterpreter to background the session prompt and go back to the msfconsole prompt.
			- pro tip- inside meterpreter, you can type help to list all commands available there
		- To interact with any session, you can use the `sessions -i` command followed by the desired session number.
		- `sessions -h` for help
		- `sessions -K` to kill all sessions. Useful when some exploits work unexpectedly and many sessions are created.

- **[Metasploit Exploitation](https://tryhackme.com/room/metasploitexploitation)** (database, exploits, msfvenom)
	- PostgreSQL setup
		- Start DB:
			- systemctl start postgresql
			-  sudo -u postgres msfdb init
		- Workspaces
			- workspace -h for all help
			- workspace to list
			- workspace -a name to add
			- workspace name to switch
		- DB commands
			- `db_nmap -sV -p- target    # Scan + save in the db`
			- `hosts                     # List hosts`
			- `services                  # List services`
			- `services -S smb           # Filter services`
			- `hosts -R                  # Set RHOSTS from the one in db`
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTIwOTYwOTMxNTldfQ==
-->